#!/usr/bin/python
import hashlib,os,sys

avdict = {}
dest = "/home/fimz/Dev/malware-collection/6000-labelled"
source = "/home/fimz/Dev/malware-collection/6000"

os.system("rm " + dest + "/* -f") ## empty destination folder
os.system("clamscan " + source + " -l scan-report.txt") ## clamscan source/input folder

content = open("scan-report.txt",'r').readlines()

for line in content:
     if "SCAN SUMMARY" in line:
             break
     if ":" in line:
	     filename, avclass = line.split(":")
	     print filename
	     print avclass
	     avclass = str(avclass)
	     avclass = avclass.strip("FOUND\n")
	     if "Trojan" in avclass:
		     avclass = avclass[len("Trojan.")+1:]
		     print "yes:",avclass
	     if "Adware" in avclass:
		     avclass = avclass[len("Adware.")+1:]
	     if "Worm" in avclass:
		     avclass = avclass[len("Worm.")+1:]
#	     print "fixed avclass: ",tempclass
	     try:
   	        if "." in avclass[0]:
		   avclass = avclass[1:]
	     except IndexError:
		   0
	     filename = filename.strip(" ")
	     if filename in avdict:
		avdict[filename].append(avclass)
	     else:
		avdict[filename] = []
		avdict[filename].append(avclass)

for f in avdict:
   temp = open(f,'r').read()
   mhash = hashlib.md5(temp).hexdigest()  ## create an md5sum of the source
   avclass = str(avdict[f][0])
   avclass = avclass.strip(" ")
   if "-" in avclass:
	avclass = avclass.replace("-",".")
   outf = open(dest+"/"+ avclass +"-"+mhash,'w') ## open output file for writting
   outf.write(temp)


